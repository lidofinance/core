# Lido Protocol Upgrade Parameters - Mainnet Configuration
# This file contains deployment parameters for upgrading Lido protocol contracts on Ethereum mainnet

[chainSpec]
# Ethereum consensus layer specifications
# TODO: take onchain?
slotsPerEpoch = 32                    # Number of slots per epoch in Ethereum consensus
secondsPerSlot = 12                   # Duration of each slot in seconds
genesisTime = 1606824023              # Ethereum mainnet genesis timestamp
depositContract = "0x00000000219ab540356cBB839Cbe05303d7705Fa"  # Official ETH2 deposit contract

# Gate seal configuration for vault operations
[gateSealForVaults]
sealDuration = 1209600  # 14 days
sealingCommittee = "0x8772E3a2D86B9347A2688f9bc1808A6d8917760C"

[easyTrack]
VaultsAdapter = "0xe2DE6d2DefF15588a71849c0429101F8ca9FB14D"

# Must be deployed before the V3 upgrading contracts
[easyTrack.newFactories]
AlterTiersInOperatorGrid = "0xa29173C7BCf39dA48D5E404146A652d7464aee14"
RegisterGroupsInOperatorGrid = "0x194A46DA1947E98c9D79af13E06Cfbee0D8610cC"
RegisterTiersInOperatorGrid = "0x5292A1284e4695B95C0840CF8ea25A818751C17F"
SetJailStatusInOperatorGrid = "0x93F1DEE4473Ee9F42c8257C201e33a6Da30E5d67"
SocializeBadDebtInVaultHub = "0x1dF50522A1D868C12bF71747Bb6F24A18Fe6d32C"
ForceValidatorExitsInVaultHub = "0x6C968cD89CA358fbAf57B18e77a8973Fa869a6aA"
UpdateGroupsShareLimitInOperatorGrid = "0x8Bdc726a3147D8187820391D7c6F9F942606aEe6"
UpdateVaultsFeesInOperatorGrid = "0x5C3bDFa3E7f312d8cf72F56F2b797b026f6B471c"

# Vault hub configuration for managing staking vaults
[vaultHub]
maxRelativeShareLimitBP = 1000           # 10%, Absolute Max possible shareLimit of a vault relative to Lido TVL (in basis points)

# Lazy oracle configuration for delayed reward calculations - https://github.com/lidofinance/lido-improvement-proposals/blob/develop/LIPS/lip-32.md
[lazyOracle]
quarantinePeriod = 259200                      # Quarantine period in seconds (3 days) before rewards are distributed
maxRewardRatioBP = 350                         # Maximum reward ratio in basis points (3.5%)
maxLidoFeeRatePerSecond = "180000000000000000" # Maximum Lido fee rate per second, in wei (0.18 ETH)

# Predeposit guarantee configuration for validator deposit guarantees
[predepositGuarantee]
genesisForkVersion = "0x00000000"     # Ethereum mainnet genesis fork version: https://github.com/ethereum/consensus-specs/blob/01b53691dcc36d37a5ad8994b3a32d8de69fb1aa/configs/mainnet.yaml#L30
gIndex            = "0x0000000000000000000000000000000000000000000000000096000000000028"  # Generalized index for state verification: https://research.lido.fi/t/lip-27-ensuring-compatibility-with-ethereum-s-pectra-upgrade/9444#p-20086-update-gindexes-5
gIndexAfterChange = "0x0000000000000000000000000000000000000000000000000096000000000028" # Required for hardfork upgrades, the same for now
changeSlot = 0                        # Slot number when the change takes effect

# Operator grid configuration for managing staking operators
[operatorGrid]
# Default tier parameters for operator classification and fee structure
# https://research.lido.fi/t/lido-v3-design-implementation-proposal/10665#p-22926-rollout-plan-9
[operatorGrid.defaultTierParams]
shareLimitInEther = "0"               # Share limit per tier in ETH
reserveRatioBP = 5000                 # Reserve ratio in basis points (50%)
forcedRebalanceThresholdBP = 4975     # Threshold for forced rebalancing in basis points (49.75%)
# https://research.lido.fi/t/default-risk-assessment-framework-and-fees-parameters-for-lido-v3-stvaults/10504#p-22550-table-3-fees-9
infraFeeBP = 100                      # Infrastructure fee in basis points (1%)
liquidityFeeBP = 650                  # Liquidity provision fee in basis points (6.5%)
reservationFeeBP = 0                  # Reservation fee in basis points (0%)

[burner]
isMigrationAllowed = true             # Must be on for the upgrade to work (for scratch is it false)

# Oracle and consensus version configuration
[oracleVersions]
ao_consensus_version = 5              # Accounting Oracle consensus version: https://etherscan.io/address/0x852deD011285fe67063a08005c71a85690503Cee#readProxyContract#F16

[v3VoteScript]
# Expiry timestamp after which the upgrade transaction will revert
# Format: Unix timestamp (seconds since epoch)
# The upgrade transaction must be executed before this deadline
expiryTimestamp = 1768435200          # January 15, 2026 0:00:00 UTC
# Initial maximum external ratio in basis points for Lido v3
# https://research.lido.fi/t/lido-v3-design-implementation-proposal/10665#p-22926-rollout-plan-9
initialMaxExternalRatioBP = 300      # 3% value set upon upgrade for the initial phase

# Sources (todo)
# - https://research.lido.fi/t/default-risk-assessment-framework-and-fees-parameters-for-lido-v3-stvaults/10504

timeConstraintsContract = "0x2a30F5aC03187674553024296bed35Aa49749DDa"  # Predeployed TimeConstraints contract on mainnet

# Oracle Daemon Config slashing reserve parameters
# how it is used: https://github.com/lidofinance/lido-oracle/blob/d6c09a16736b2c132343a4e349c8f27179c73e6e/src/services/staking_vaults.py#L207-L235
odcSlashingReserveWeRightShiftEpochs = 8192  # EPOCHS_PER_SLASHINGS_VECTOR - https://eth2book.info/capella/part3/config/preset/#epochs_per_slashings_vector
odcSlashingReserveWeLeftShiftEpochs = 8192   # EPOCHS_PER_SLASHINGS_VECTOR
